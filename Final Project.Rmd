---
title: "Final Project BST 260: The Effects of Pesticide Exposure on Maternal and Child Health (Lara, Sonia, Zainab)"
output: html_document
---
Load Packages
```{r}
library(dplyr)
library(tidyverse)
library(pdftools)
library(readr)
library(stringr)

```

Load Datasets
```{r}

```

MCH Data Wrangling *Low BW Only
```{r}
#Data Wrangling for Year 2014-2018 Data 
lbwdata<- read.csv("low-and-very-low-birthweight-by-county-2014-2018 (1).csv", header = TRUE, stringsAsFactors = FALSE)
lbwdata$Events[is.na(lbwdata$Events)] <- 0
lbwdata <- lbwdata %>% group_by(Year, County, Total.Births) %>% summarize(Events = sum(Events)) 
lbwdata <- lbwdata %>% filter(!County == "california")#removing the total count
lbwdata <- lbwdata %>% mutate(rate = Events/Total.Births * 100)
``` 

MCH Data Wrangling *New CDC Data (Lara)
```{r}
#Data Wrangling for CDC Data (COMPLETE)
MCH.CDC.Data <- read.delim("NatalityTOTAL.txt",  sep ="\t", dec=".", header = TRUE, stringsAsFactors = FALSE)
MCH.CDC.Data <- MCH.CDC.Data[-c(491:585), ]
MCH.CDC.Data <- MCH.CDC.Data %>% filter(Notes != "Total")
MCH.CDC.Data <- MCH.CDC.Data[ ,-c(1,3,5,7,9)]

MCH.CDC.Data_Race <- read.delim("NatalityRACE.txt",  sep ="\t", dec=".", header = TRUE, stringsAsFactors = FALSE)
MCH.CDC.Data_Race <- MCH.CDC.Data_Race[-c(1794:1931), ]
MCH.CDC.Data_Race <- MCH.CDC.Data_Race[ ,-c(1,3,5,7,9,11)]

MCH.CDC.Data_Care <- read.delim("NatalityCARE.txt",  sep ="\t", dec=".", header = TRUE, stringsAsFactors = FALSE)
MCH.CDC.Data_Care <- MCH.CDC.Data_Care[-c(11063:11487), ]
MCH.CDC.Data_Care <- MCH.CDC.Data_Care[ ,-c(1,3,5,7,9, 11,13)]

#Rename Counties to Match Pesticide Data
MCH.CDC.Data[MCH.CDC.Data$County == "Alameda County, CA", "County"] <-"Alameda"
MCH.CDC.Data[MCH.CDC.Data$County == "Butte County, CA", "County"] <-"Butte"
MCH.CDC.Data[MCH.CDC.Data$County == "Contra Costa County, CA", "County"] <-"Contra Costa"
MCH.CDC.Data[MCH.CDC.Data$County == "El Dorado County, CA", "County"] <-"El Dorado"
MCH.CDC.Data[MCH.CDC.Data$County == "Fresno County, CA", "County"] <-"Fresno"
MCH.CDC.Data[MCH.CDC.Data$County == "Humboldt County, CA", "County"] <-"Humboldt"
MCH.CDC.Data[MCH.CDC.Data$County == "Imperial County, CA", "County"] <-"Imperial"
MCH.CDC.Data[MCH.CDC.Data$County == "Kern County, CA", "County"] <-"Kern"
MCH.CDC.Data[MCH.CDC.Data$County == "Kings County, CA", "County"] <-"Kings"
MCH.CDC.Data[MCH.CDC.Data$County == "Los Angeles County, CA", "County"] <-"Los Angeles"
MCH.CDC.Data[MCH.CDC.Data$County == "Madera County, CA", "County"] <-"Madera"
MCH.CDC.Data[MCH.CDC.Data$County == "Marin County, CA", "County"] <-"Marin"
MCH.CDC.Data[MCH.CDC.Data$County == "Contra Costa County, CA", "County"] <-"Mariposa"
MCH.CDC.Data[MCH.CDC.Data$County == "Merced County, CA", "County"] <-"Merced"
MCH.CDC.Data[MCH.CDC.Data$County == "Monterey County, CA", "County"] <-"Monterey"
MCH.CDC.Data[MCH.CDC.Data$County == "Napa County, CA", "County"] <-"Napa"
MCH.CDC.Data[MCH.CDC.Data$County == "Orange County, CA", "County"] <-"Orange"
MCH.CDC.Data[MCH.CDC.Data$County == "Placer County, CA", "County"] <-"Placer"
MCH.CDC.Data[MCH.CDC.Data$County == "Riverside County, CA", "County"] <-"Riverside"
MCH.CDC.Data[MCH.CDC.Data$County == "Sacramento County, CA", "County"] <-"Sacramento"
MCH.CDC.Data[MCH.CDC.Data$County == "San Bernardino County, CA", "County"] <-"San Bernardino"
MCH.CDC.Data[MCH.CDC.Data$County == "San Diego County, CA", "County"] <-"San Diego"
MCH.CDC.Data[MCH.CDC.Data$County == "San Francisco County, CA", "County"] <-"San Francisco"
MCH.CDC.Data[MCH.CDC.Data$County == "San Joaquin County, CA", "County"] <-"San Joaquin"
MCH.CDC.Data[MCH.CDC.Data$County == "San Luis Obispo County, CA", "County"] <-"San Luis Obispo"
MCH.CDC.Data[MCH.CDC.Data$County == "San Mateo County, CA", "County"] <-"San Mateo"
MCH.CDC.Data[MCH.CDC.Data$County == "Santa Barbara County, CA", "County"] <-"Santa Barbara"
MCH.CDC.Data[MCH.CDC.Data$County == "Santa Clara County, CA", "County"] <-"Canta Clara"
MCH.CDC.Data[MCH.CDC.Data$County == "Santa Cruz County, CA", "County"] <-"Santa Cruz"
MCH.CDC.Data[MCH.CDC.Data$County == "Shasta County, CA", "County"] <-"Shasta"
MCH.CDC.Data[MCH.CDC.Data$County == "Solano County, CA", "County"] <-"Solano"
MCH.CDC.Data[MCH.CDC.Data$County == "Sonoma County, CA", "County"] <-"Sonoma"
MCH.CDC.Data[MCH.CDC.Data$County == "Stanislaus County, CA", "County"] <-"Stanislaus"
MCH.CDC.Data[MCH.CDC.Data$County == "Tulare County, CA", "County"] <-"Tulare"
MCH.CDC.Data[MCH.CDC.Data$County == "Ventura County, CA", "County"] <-"Ventura"
MCH.CDC.Data[MCH.CDC.Data$County == "Yolo County, CA", "County"] <-"Yolo"

MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Alameda County, CA", "County"] <-"Alameda"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Butte County, CA", "County"] <-"Butte"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Contra Costa County, CA", "County"] <-"Contra Costa"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "El Dorado County, CA", "County"] <-"El Dorado"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Fresno County, CA", "County"] <-"Fresno"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Humboldt County, CA", "County"] <-"Humboldt"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Imperial County, CA", "County"] <-"Imperial"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Kern County, CA", "County"] <-"Kern"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Kings County, CA", "County"] <-"Kings"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Los Angeles County, CA", "County"] <-"Los Angeles"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Madera County, CA", "County"] <-"Madera"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Marin County, CA", "County"] <-"Marin"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Contra Costa County, CA", "County"] <-"Mariposa"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Merced County, CA", "County"] <-"Merced"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Monterey County, CA", "County"] <-"Monterey"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Napa County, CA", "County"] <-"Napa"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Orange County, CA", "County"] <-"Orange"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Placer County, CA", "County"] <-"Placer"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Riverside County, CA", "County"] <-"Riverside"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Sacramento County, CA", "County"] <-"Sacramento"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "San Bernardino County, CA", "County"] <-"San Bernardino"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "San Diego County, CA", "County"] <-"San Diego"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "San Francisco County, CA", "County"] <-"San Francisco"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "San Joaquin County, CA", "County"] <-"San Joaquin"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "San Luis Obispo County, CA", "County"] <-"San Luis Obispo"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "San Mateo County, CA", "County"] <-"San Mateo"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Santa Barbara County, CA", "County"] <-"Santa Barbara"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Santa Clara County, CA", "County"] <-"Santa Clara"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Santa Cruz County, CA", "County"] <-"Santa Cruz"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Shasta County, CA", "County"] <-"Shasta"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Solano County, CA", "County"] <-"Solano"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Sonoma County, CA", "County"] <-"Sonoma"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Stanislaus County, CA", "County"] <-"Stanislaus"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Tulare County, CA", "County"] <-"Tulare"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Ventura County, CA", "County"] <-"Ventura"
MCH.CDC.Data_Race[MCH.CDC.Data_Race$County == "Yolo County, CA", "County"] <-"Yolo"

MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Alameda County, CA", "County"] <-"Alameda"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Butte County, CA", "County"] <-"Butte"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Contra Costa County, CA", "County"] <-"Contra Costa"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "El Dorado County, CA", "County"] <-"El Dorado"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Fresno County, CA", "County"] <-"Fresno"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Humboldt County, CA", "County"] <-"Humboldt"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Imperial County, CA", "County"] <-"Imperial"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Kern County, CA", "County"] <-"Kern"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Kings County, CA", "County"] <-"Kings"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Los Angeles County, CA", "County"] <-"Los Angeles"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Madera County, CA", "County"] <-"Madera"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Marin County, CA", "County"] <-"Marin"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Contra Costa County, CA", "County"] <-"Mariposa"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Merced County, CA", "County"] <-"Merced"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Monterey County, CA", "County"] <-"Monterey"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Napa County, CA", "County"] <-"Napa"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Orange County, CA", "County"] <-"Orange"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Placer County, CA", "County"] <-"Placer"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Riverside County, CA", "County"] <-"Riverside"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Sacramento County, CA", "County"] <-"Sacramento"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "San Bernardino County, CA", "County"] <-"San Bernardino"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "San Diego County, CA", "County"] <-"San Diego"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "San Francisco County, CA", "County"] <-"San Francisco"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "San Joaquin County, CA", "County"] <-"San Joaquin"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "San Luis Obispo County, CA", "County"] <-"San Luis Obispo"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "San Mateo County, CA", "County"] <-"San Mateo"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Santa Barbara County, CA", "County"] <-"Santa Barbara"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Santa Clara County, CA", "County"] <-"Santa Clara"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Santa Cruz County, CA", "County"] <-"Santa Cruz"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Shasta County, CA", "County"] <-"Shasta"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Solano County, CA", "County"] <-"Solano"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Sonoma County, CA", "County"] <-"Sonoma"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Stanislaus County, CA", "County"] <-"Stanislaus"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Tulare County, CA", "County"] <-"Tulare"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Ventura County, CA", "County"] <-"Ventura"
MCH.CDC.Data_Care[MCH.CDC.Data_Care$County == "Yolo County, CA", "County"] <-"Yolo"


View(MCH.CDC.Data)
View(MCH.CDC.Data_Race) 
View(MCH.CDC.Data_Care)


``` 
Data Key:
'MCH.CDC.Data' is general data by county 
'MCH.CDC.Data_Race' is stratified by race 
'MCH.CDC.Data_Care' is stratified by race & includes month prenatal care began

Variable Key:
Birth Rate = The number of births divided by total population in the given year(s).

Pesticide Data Wrangling

```{r}
county_ranks16 <- read_delim("table1_county_rank_2016.txt", "\t", escape_double = FALSE, trim_ws = TRUE)
repro_lbs16 <- read_delim("table3_reproductive_lbs_2016.txt", "\t", escape_double = FALSE, trim_ws = TRUE)
repro_acre16 <- read_delim("table4_reproductive_acres_2016.txt", "\t", escape_double = FALSE, trim_ws = TRUE)


table1_2016 <- county_ranks16 %>% transmute(county = COUNTY, 
                                     lbs_2015 = LBS_2015, rank_2015 = RANK_2015, 
                                     lbs_2016 = LBS_2016, rank_2016 = RANK_2016)
# column 1 is the county
# columns 2-3 have the previous year data
# columns 4-5 have the current year data

# we only want columns 1-3 for the most up-to-date data for all years before 2016
all_dat <- list(read_csv("table1_2007.csv")[1:3],
                read_csv("table1_2008.csv")[1:3],
                read_csv("table1_2009.csv")[1:3],
                read_csv("table1_2010.csv")[1:3],
                read_csv("table1_2011.csv")[1:3],
                read_csv("table1_2012.csv")[1:3],
                read_csv("table1_2013.csv")[1:3],
                read_csv("table1_2014.csv")[1:3],
                read_csv("table1_2015.csv")[1:3])


table1 <- Reduce(function(x, y) left_join(x, y, by = "county"), all_dat)


long_table1 <- table1 %>% pivot_longer(!county, names_to = 'usage', values_to = "value")
table1_ranks <- long_table1 %>% filter(str_starts(usage, "rank"))
table1_lbs <- long_table1 %>% filter(str_starts(usage, "lbs"))
```

Sonia's Work with LBW Data
```{r}
#Histogram by county  
lbwdata %>% 
  filter(Year == 2014 & !is.na(rate)) %>% 
  ggplot(aes(County, rate)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 1/2))
 
#Heatmap 
library(maps)
CaliforniaCounty <- map_data("county", "california")
head(CaliforniaCounty)

CaliforniaCounty %>% ggplot(aes(x = long, y = lat, group = group)) + 
                  geom_polygon(fill = "white", color = "black") +
                  theme(panel.grid.major = element_blank(), 
                        panel.background = element_blank(),
                        axis.title = element_blank(), 
                        axis.text = element_blank(),
                        axis.ticks = element_blank()) +
                  coord_fixed(1.3)

california_map <- lbwdata %>% full_join(CaliforniaCounty, by = c("County" = "subregion")) %>% mutate(rate = Events/Total.Births * 10^2)

#see Sonia's app for the shiny app 
```

